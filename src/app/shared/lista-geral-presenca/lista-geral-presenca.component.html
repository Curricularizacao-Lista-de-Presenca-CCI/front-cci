<body>

  <div class="d-flex min-vh-100">

    <app-navbar></app-navbar>

    <div class="flex-fill p-5" style="overflow-y: visible; min-height: 100vh;">

      <div class="content container-fluid p-0">
        <h2 class="titulo-principal text-primary fw-bold mb-5">Lista Geral de Presença</h2>

        <div class="caixa-lista shadow p-4 rounded">
          <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-3">
            <div>
              <h5 class="titulo-lista mb-0">Lista de Alunos</h5>
            </div>
            <div class="d-flex align-items-center gap-4">
              
              <div class="input-group busca">
                <span class="input-group-text bg-white border-end-0">
                  <i class="bi bi-search text-muted"></i>
                </span>
                <input type="text" class="form-control border-start-0" placeholder="Buscar" />
              </div>

              <div class="d-flex justify-content-center">
                  <button class="btn btn-primary justify-content-end" (click)="abrirModalEditarChamada()" *ngIf="funcionarioLogado?.atuacao === 'C'">
                    Editar chamada
                  </button>
              </div>

              <div class="d-flex justify-content-center">
                  <button class="btn btn-success justify-content-end" (click)="abrirModalChamada()" *ngIf="funcionarioLogado?.atuacao === 'C'">
                    Finalizar chamada
                  </button>
              </div>

            </div>
          </div>

          <div class="table-responsive">
            <table class="table tabela-membros">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nome</th>
                  <th>Data do Evento</th>
                  <th>Presença</th>
                </tr>
              </thead>

              <tbody>

                <tr *ngFor="let aluno of alunos">
                  <td data-label="ID">{{ aluno.idAluno }}</td>
                  <td data-label="Nome">{{ aluno.nomeAluno }}</td>
                  <td data-label="Inscrição">{{ aluno.data }}</td>
                  <td data-label="Status"><span class="badge status {{ aluno.status == 'Sim' ? 'ativo' : 'inativo' }}">
                      {{ aluno.status }}
                    </span></td>
              </tbody>

            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>

<!-- Dialog de Edição de Chamada -->
<div class="modal fade" id="dialogEdicaoChamada" #dialogEdicaoChamadaRef tabindex="-1"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Evento</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <!-- <form [formGroup]="chamadaForm" (ngSubmit)="enviarArquivo()"> -->

          <!-- <form>

          <div class="mb-3">
            <label for="descricao" class="form-label">Local do Evento</label>
            <input type="text" class="form-control" formControlName="local" id="descricao"
              placeholder="Informe o Local do Evento">
          </div>

          <div class="mb-3">
            <label for="servidor" class="form-label">Adicionar Servidor</label>
            <select class="form-select" id="servidor" formControlName="servidor">
              <option [ngValue]="null" selected disabled>Selecione um Servidor</option>

              <option *ngFor="let func of funcionarios" [ngValue]="func.idFuncionario">
                {{ func.nome }}
              </option>
            </select>
          </div>

          <div class="d-flex justify-content-between align-items-center gap-2 mb-4">
            <div>
              <label for="meuInputFile" class="btn btn-primary">
                <i class="bi bi-upload"></i>
                Importar
              </label>

              <input type="file" id="meuInputFile" class="d-none" (change)="onFileSelected($event)" #fileInputRef
                accept=".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
              <span class="text-muted ps-2">
                {{ nomeArquivo || 'Nenhum arquivo selecionado' }}
              </span>
            </div>

            <button class="btn btn-danger" (click)="removerArquivo()">
              <i class="bi bi-x-circle"></i>
            </button>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="bi bi-x"></i>
              Cancelar</button>

            <button type="submit" class="btn btn-success" [disabled]="chamadaForm.invalid">
              <i class="bi bi-check2"></i> Salvar
            </button>
          </div>
        </form> -->
      </div>
    </div>
  </div>
</div>

<!-- Dialog de Confirmação de Registro -->
<div class="modal fade" id="dialogFinalizarChamada" #dialogFinalizarChamadaRef tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Finalizar Chamada</h1>
        <button type="button" class="btn-close" (click)="dialogFinalizarChamada = false" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="fw-bold">Deseja realmente finalizar a lista de chamada?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="dialogFinalizarChamada = false">Cancelar</button>

        <button type="button" (click)="finalizarChamada()" class="btn btn-success">
          Finalizar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast de Sucesso de Edição -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" #liveToastEdicaoSuccess class="toast text-bg-success border-0" role="alert" aria-live="assertive"
    aria-atomic="true">

    <div class="toast-header text-bg-success border-0">
      <strong class="me-auto">Sucesso ao enviar Arquivo</strong>

      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>

    <div class="toast-body">
      {{ mensagemSucesso }}
    </div>
  </div>
</div>

<!-- Toast de Erro de Edição -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" #liveToastEdicaoError class="toast text-bg-danger border-0" role="alert" aria-live="assertive"
    aria-atomic="true">

    <div class="toast-header text-bg-danger border-0">
      <strong class="me-auto">Erro ao enviar Arquivo</strong>

      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>

    <div class="toast-body">
      {{ mensagemErro }}
    </div>
  </div>
</div>

<!-- Toast de Erro de Finalização -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" #liveToastError class="toast text-bg-danger border-0" role="alert" aria-live="assertive"
    aria-atomic="true">

    <div class="toast-header text-bg-danger border-0">
      <strong class="me-auto">Erro ao finalizar chamada</strong>

      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>

    <div class="toast-body">
      {{ mensagemErro }}
    </div>
  </div>
</div>

<!-- Toast de Sucesso de Finalização -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" #liveToastSuccess class="toast text-bg-success border-0" role="alert" aria-live="assertive"
    aria-atomic="true">

    <div class="toast-header text-bg-success border-0">
      <strong class="me-auto">Chamada finalizada com sucesso</strong>

      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>

    <div class="toast-body">
      {{ mensagemSucesso }}
    </div>
  </div>
</div>